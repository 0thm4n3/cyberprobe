
AT_INIT
AT_COLOR_TESTS

# ----------------------------------------------------------------------------

AT_BANNER([PCAP samples decoded with cybermon.])

AT_SETUP([cpsfnet.pcap])
cat $abs_srcdir/samples/cpsfnet.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/cpsfnet.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([dns2.pcap])
cat $abs_srcdir/samples/dns2.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/dns2.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([ether.pcap])
cat $abs_srcdir/samples/ether.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/ether.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([exampleorg.pcap])
cat $abs_srcdir/samples/exampleorg.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/exampleorg.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

#AT_SETUP([ftp.pcap])
#cat $abs_srcdir/samples/ftp.pcap | \
#    $abs_top_srcdir/src/cybermon - $abs_top_srcdir/config/cybermon.lua | \
#    sort > output1
#sort < $abs_srcdir/samples/ftp.pcap.monitor > output2
#AT_CHECK([diff output1 output2],,[])
#AT_CLEANUP

AT_SETUP([malware.pcap])
cat $abs_srcdir/samples/malware.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/malware.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([smtp.pcap])
cat $abs_srcdir/samples/smtp.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/smtp.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([tcp.pcap])
cat $abs_srcdir/samples/tcp.pcap | \
    cybermon - $abs_top_srcdir/config/cybermon.lua | \
    sort > output1
sort < $abs_srcdir/samples/tcp.pcap.monitor > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

# ----------------------------------------------------------------------------

AT_BANNER([PCAP samples decoded with cybermon, and STIX indicators.])

AT_SETUP([cpsfnet.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/cpsfnet.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/cpsfnet.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([dns2.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/dns2.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/dns2.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([ether.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/ether.pcap | \
    $abs_top_srcdir/src/cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/ether.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([exampleorg.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/exampleorg.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/exampleorg.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

#AT_SETUP([ftp.pcap])
#cat $abs_srcdir/samples/ftp.pcap | \
#    $abs_top_srcdir/src/cybermon - $abs_top_srcdir/config/stix-alert.lua | \
#    sort > output1
#sort < $abs_srcdir/samples/ftp.pcap.indicators > output2
#AT_CHECK([diff output1 output2],,[])
#AT_CLEANUP

AT_SETUP([malware.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/malware.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/malware.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([smtp.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/smtp.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/smtp.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP

AT_SETUP([tcp.pcap])
STIX_INDICATORS=$abs_srcdir/stix/stix-default-combined.json
export STIX_INDICATORS
cat $abs_srcdir/samples/tcp.pcap | \
    cybermon - $abs_top_srcdir/config/stix-alert.lua | \
    sort > output1
sort < $abs_srcdir/samples/tcp.pcap.indicators > output2
AT_CHECK([diff output1 output2],,[])
AT_CLEANUP
